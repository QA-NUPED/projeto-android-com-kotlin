name: Automated Coverage Bot

on:
  issue_comment:
    types:
      - created

jobs:
  update_coverage:
    runs-on: ubuntu-latest
    steps:
      - name: Check for trigger keyword
        uses: actions/github-script@v4
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const triggerKeyword = '@bot-atualizar-cobertura';
            const commentBody = context.payload.comment.body;
            if (commentBody.includes(triggerKeyword)) {
              // Execute lógica para calcular a cobertura atual
              const currentBranchCoverage = 85; // Substitua pelo valor real da cobertura

              // Crie a nova tabela de cobertura
              const newCoverageTable = `
                ### Code Coverage

                | Directory | Desired Coverage | Current Branch Coverage | Status |
                |-----------|------------------|-------------------------|:------:|
                | Dir 1     | 80%              | ${currentBranchCoverage}% | :white_check_mark: |
                | Dir 2     | 88%              | ${currentBranchCoverage}% | :white_check_mark: |
                | Dir 3     | 72%              | ${currentBranchCoverage}% | :white_check_mark: |
                | Dir 4     | 85%              | ${currentBranchCoverage}% | :white_check_mark: |
                | Dir 5     | 90%              | ${currentBranchCoverage}% | :white_check_mark: |
              `;

              // Use a API do GitHub para adicionar o comentário com a nova tabela
              github.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body: newCoverageTable,
              });
            }
