name: Manual Quality Gate

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Set manual coverage values
        id: set_coverage
        run: |
          echo "Setting manual coverage values..."
          echo "::set-output name=coverage::50" # Substitua pelo valor real de cobertura desejado
        env:
          COVERAGE_THRESHOLD: ${{ steps.set_coverage.outputs.coverage }}

      - name: Calculate coverage
        id: calculate_coverage
        run: |
          CURRENT_COVERAGE: 55 # Substitua pelo valor real da cobertura atual
        env:
          CURRENT_COVERAGE: ${{ steps.calculate_coverage.outputs.coverage }}

      - name: Check coverage against quality gate
        run: |
          if [[ $CURRENT_COVERAGE -lt $COVERAGE_THRESHOLD ]]; then
            echo "Coverage in the 'app' directory is below the threshold."
          else
            echo "Coverage in the 'app' directory meets the threshold."
          fi
